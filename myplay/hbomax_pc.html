<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://content.jwplatform.com/libraries/KB5zFt7A.js"></script>
<script> jwplayer.key='XSuP4qMl+9tK17QNb+4+th2Pm9AWgMO/cYH8CI0HGGr7bdjo';</script>
</head>


    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        #player {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
        }

        #player iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
    
<body>
<div id="player"></div>
<script>
let tk;

fetch('https://meuplayerdejogos.meujogador.workers.dev/hbo/auth.php?tk')
  .then(response => response.json())
  .then(data => {
    tk = data.access_token;
    setupRequest();
  })
  .catch(error => {
    console.error('Failed to fetch access token:', error);
  });

function setupRequest() {
  const apiUrl = 'https://comet-latam.api.hbo.com/content';
  const headers = {
    Accept: 'application/vnd.hbo.v9.full+json',
    'Accept-Encoding': 'gzip, deflate, br',
    'Accept-Language': 'pt-BR',
    Authorization: 'Bearer ' + tk,
    'Content-Type': 'application/json',
    Origin: 'https://play.hbomax.com',
    Referer: 'https://play.hbomax.com/',
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.0.0 Safari/537.36',
  };

  async function fetchVideoData(videoId) {
    const requestBody = {
      id: videoId,
          headers: {
            'x-hbo-is-lat': false,
            'x-hbo-device-model': 'Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Mobile Safari/537.36',
          },
        };

    try {
      const response = await fetch(apiUrl, {
        method: 'POST',
        headers: headers,
        body: JSON.stringify([requestBody]),
      });

      if (!response.ok) {
        throw new Error('Network response was not ok');
      }

      const responseData = await response.json();

      for (let item of responseData) {
        if (item.body && item.body.references && item.body.references.video) {
          return item.body.references.video;
        }
      }

      throw new Error('Video data not found.');
    } catch (error) {
      throw new Error('Error fetching video data:', error);
    }
  }

  const queryParams = new URLSearchParams(window.location.search);
  const videoId = queryParams.get('id') || 'DEFAULT_VALUE';

  if (!videoId) {
    console.error('VideoId not provided in the URL!');
    return;
  }

  async function fetchManifest(videoInfo) {
    const requestBody = {
      id: videoInfo,
          headers: {
            'x-hbo-is-lat': false,
            'x-hbo-device-model': 'Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Mobile Safari/537.36',
          },
        };

    try {
      const response = await fetch(apiUrl, {
        method: 'POST',
        headers: headers,
        body: JSON.stringify([requestBody]),
      });

      if (!response.ok) {
        throw new Error('Network response was not ok');
      }

      const responseData = await response.json();

      if (responseData[0] && responseData[0].body && responseData[0].body.manifests) {
        const manifestUrl = responseData[0].body.manifests[0].url;
        const licenseUrl = responseData[0].body.manifests[0].drm.licenseUrl;

        return { mpd: manifestUrl, license: licenseUrl };
      } else {
        throw new Error('Manifest URL not found.');
      }
    } catch (error) {
      throw new Error('Error fetching manifest data:', error);
    }
  }

  fetchVideoData(videoId)
    .then(videoInfo => fetchManifest(videoInfo))
    .then(manifestData => {
      var playerInstance = jwplayer('player');
      playerInstance.setup({
        playlist: [
          {
            sources: [
              {
                default: false,
                type: 'dash',
                file: manifestData.mpd,
                drm: {
                  widevine: {
                    url: manifestData.license,
                    headers: [
                      {
                        name: 'Authorization',
                        value: 'Bearer ' + tk,
                      },
                    ],
                  },
                },
                label: '0',
              },
            ],
          },
        ],
        width: '100%',
        height: '100%',
        aspectratio: '16:9',
        autostart: false,
        cast: {},
        sharing: false,
      });
    })
    .catch(error => {
      console.error('There was an error:', error);
    });
}

</script>
